define("kandl/navigation/navigation",["kandl/vendors/microajax-1","kandl/common"],function(g,h){var e,f={isIE:false,PHASES:".k-nav-1 > li:first-child > ol > li > a",LEVELS:".k-nav-1 > li:first-child > ol > li > ol > li > a",LEVELS_MOBILE_LINK:".k-nav-1 > li:first-child > a",ALL_SUBJECTS_LINK:".k-nav-1 .allsubjects a",ACTIVE:"active",ARROW:".arrow",SUBJECTS_CONTAINER_CLEARFIX:"k-nav-1-subjects-container k-clearfix",SUBJECTS_CONTAINER:".k-nav-1-subjects-container",MOBILE_HIDDEN:"mobile-hidden",ALL_SUBJECTS:"allsubjects",HIGHLIGHTED:"highlighted",CONCEPT_LIST:".concept-list",SUBJECTS_COLUMN:"subjects k-type-body-index column",LOADING:"loading",ALL_LEVELS:"alllevels",SUB_MENU_CONTAINER:".k-sub-menu-container",subNavContainer:null,lastClickedLink:null,linkResponseRequestedFor:null,linksCacheObject:{},clickedLinkList:[],ajaxUpdating:false,callAjax:false,elementAppended:false,init:function(b){var a;this.isIE=h.isIE();e=b;if(b){f.subNavContainer=b.querySelector(f.SUB_MENU_CONTAINER);this.addDrawerClickHandler(b.querySelector(f.LEVELS_MOBILE_LINK),false);this.addDrawerClickHandler(b.querySelector(f.ALL_SUBJECTS_LINK),true);a=this;h.mapDomNodeList(b.querySelectorAll(f.PHASES),function(c){a.addDrawerClickHandler(c,false)});h.mapDomNodeList(b.querySelectorAll(f.LEVELS),function(c){a.addDrawerClickHandler(c,true)});a.checkLevelsHeight();h.addEvent("resize",function(c){a.checkLevelsHeight()},window);h.addEvent("orientationchange",function(c){a.checkLevelsHeight()},window)}h.addEvent("click",function(d){var i=document.querySelectorAll(".phases .phase.mobile-hidden"),c=document.querySelectorAll(".phases .phase.active"),l=0;if(c.length!==1){for(l=0;l<i.length;++l){h.removeClass(i[l],"mobile-hidden")}}},document.querySelector(".k-nav-1 .alllevels"))},toogleActivePhase:function(b){var c=document.querySelectorAll(".k-nav-1 > li:first-child > ol > li.active"),a=document.querySelector("."+f.ALL_LEVELS);if(!h.hasClass(b,f.ALL_LEVELS)){if(c.length===1){h.addClass(a,f.ACTIVE);h.removeClass(c[0],f.MOBILE_HIDDEN)}else{h.removeClass(a,f.ACTIVE)}this.checkLevelsHeight()}},addDrawerClickHandler:function(b,a){b.addEventListener("click",function(d){d.preventDefault();var l=f.getParentListItem(this),k=this,c=l.querySelector(f.ARROW);f.elementAppended=false;f.clickedLinkList.push(k);f.callAjax=a;f.updateSubMenu(l,k,c);f.toogleActivePhase(l)})},hideLoader:function(){h.removeClass(f.subNavContainer,f.LOADING)},showLoader:function(){h.addClass(f.subNavContainer,f.LOADING)},updateSubMenu:function(c,b,a){if(h.hasClass(c,f.ACTIVE)){f.clearActive(c.parentNode);f.clearMobileHidden(c.parentNode);f.hideLoader()}else{f.clearActive(c.parentNode);h.addClass(c,f.ACTIVE);if(!h.hasClass(c,f.ALL_LEVELS)&&!h.hasClass(c.parentNode.parentNode,f.ALL_LEVELS)){f.showLoader()}else{f.hideLoader()}if(f.callAjax){f.lastClickedLink=f.clickedLinkList.pop();f.clickedLinkList=[];if(f.ajaxUpdating===false){f.ajaxUpdating=true;f.getAjaxResponse()}}f.setMobileHidden(c.parentNode)}},getAjaxResponse:function(){f.linkResponseRequestedFor=f.lastClickedLink;if(f.linksCacheObject.hasOwnProperty(f.lastClickedLink)){f.subjectsCallBackHandler(f.linksCacheObject[f.lastClickedLink])}else{g(f.linkResponseRequestedFor.href+".html?cb="+new Date().getTime().toString(),f.subjectsCallBackHandler,{headers:{"X-Transclude":1}})}},addResponseToCacheObject:function(a){f.linksCacheObject[f.linkResponseRequestedFor]=a},subjectsCallBackHandler:function(d){if(!f.linksCacheObject.hasOwnProperty(f.linkResponseRequestedFor)){f.addResponseToCacheObject(d)}var j=f.lastClickedLink.parentNode,b,c;if(h.hasClass(j,f.ACTIVE)){if(f.linkResponseRequestedFor===f.lastClickedLink){b=document.createElement("div");b.className=f.SUBJECTS_CONTAINER_CLEARFIX;b.innerHTML=d;c=b.querySelector("ol");h.removeClass(c,"k-type-body-article");h.addClass(c,"k-type-body-index");h.addClass(c,"k-clearfix");if(!f.elementAppended){f.subNavContainer.appendChild(b);f.elementAppended=true}f.hideLoader();f.ajaxUpdating=false;var a=document.createEvent("Event");a.initEvent("navLoaded",true,true);document.dispatchEvent(a)}else{f.getAjaxResponse()}}else{f.ajaxUpdating=false}},clearActive:function(b){var a=e.querySelector(f.SUBJECTS_CONTAINER);h.mapDomNodeList(b.querySelectorAll("."+f.ACTIVE),function(c){h.removeClass(c,f.ACTIVE);f.hideLoader()});h.removeClass(e.querySelector("."+f.ALL_SUBJECTS),f.ACTIVE);h.removeClass(e.querySelector("."+f.ALL_SUBJECTS),f.HIGHLIGHTED);if(a){a.parentNode.removeChild(a)}},setMobileHidden:function(a){h.mapDomNodeList(a.childNodes,function(b){if(!h.hasClass(b,f.ACTIVE)){h.addClass(b,f.MOBILE_HIDDEN)}else{h.removeClass(b,f.MOBILE_HIDDEN)}})},clearMobileHidden:function(a){h.mapDomNodeList(a.querySelectorAll("."+f.MOBILE_HIDDEN),function(b){h.removeClass(b,f.MOBILE_HIDDEN)})},getParentListItem:function(a){var b=a.parentNode;if(!b||!b.tagName){return false}if(b.tagName.toLowerCase()==="li"){return b}return f.getParentListItem(b)},processColumns:function(n){var c=n.querySelectorAll("li"),d=n.querySelector("ol"),a=c.length/4,m,b,l;d.className=f.SUBJECTS_COLUMN;if(n.querySelector(f.CONCEPT_LIST)!==null){n=n.querySelector(f.CONCEPT_LIST)}for(m=0;m<c.length;m+=a){b=Array.prototype.slice.call(c,m,m+a);if(m>0){d=document.createElement("ol");d.className=f.SUBJECTS_COLUMN;n.appendChild(d)}for(l=0;l<b.length;l+=1){d.appendChild(b[l])}}},checkLevelsHeight:function(){var a=0,F=0,C=document.querySelector(".k-nav-1"),v=document.querySelector(".k-nav-1 > .alllevels > ol > .active"),D=document.querySelectorAll(".k-nav-1 > .alllevels > ol > li"),B=document.querySelector(".k-nav-1 > .allsubjects"),i=h.getElementPosition(B),y=i.bottom-i.top;if(!h.isMobile()&&v!=null){var z=v.querySelector("a");var c=h.getElementPosition(z);a=c.bottom-c.top;var d=document.querySelectorAll(".k-nav-1 > .alllevels > ol > .active  > .levels > li");if(d!=null&&d.length>0){var b=d[0];var A=d[d.length-1];var E=h.getElementPosition(b).top;var w=h.getElementPosition(A).bottom;F=w-E}if(!h.isMobile()&&(a+F>0)){C.style.height=a+F+"px";v.style.height=a+F+"px"}else{C.style.height=y+"px";v.style.height=y+"px"}}else{if(!h.isMobile()){C.style.height=y+"px";for(var x=0;x<D.length;x++){D[x].style.height=y+"px"}}else{C.style.height="auto";for(var x=0;x<D.length;x++){D[x].style.height="auto"}}}}};return f});