<!DOCTYPE html>
<!-- saved from url=(0101)http://www.cosc.canterbury.ac.nz/csfieldguide/dev/dev/_static/widgets/DR/DR-color/CG-ColorBits_2.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<title>jQuery UI Slider - Colorpicker</title>
	
	<link rel="stylesheet" href="jquery-ui.css">
	<script src="jquery-1.9.1.js"></script>
	<script src="jquery-ui.js"></script>
	<script src="jquery.balloon.js"></script>
	
	<!--Android Compatible Touch-->
	<script src="jquery.ui.touch-punch.min.js"></script>
	
	<style>
	#helpButton
	{ }

	.mainContent
	{
		margin-top:30px;
		margin-bottom:30px;
		height:330px;
	}

	.add-shadow {
		-moz-box-shadow: 4px 4px 20px rgba(0,0,0,0.8);
		-webkit-box-shadow: 4px 4px 20px rgba(0,0,0,0.8);
		box-shadow: 4px 4px 20px rgba(0,0,0,0.8);
	}
	
	.add-embossed {
		/* Background */
		background: rgba(0.0, 0, 0, 0.2);
	 
		/* Border bottom light */
		border-bottom: 1px solid rgba(255, 255, 255, 0.1);
	 
		/* Inner top shadow */
		-moz-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.5);
		-webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.5);
		box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.5);
	 
		/* Round corners */
		-webkit-border-radius: 10px;
		-moz-border-radius: 10px;
		border-radius: 10px;	
	}
	
	.add-text-embossed
	{
		 text-shadow: #fff 0px 1px 0, #000 0 -1px 0;
	}
	
	barslider { float:left; }

	#red8, #green8, #blue8, #red3, #green3, #blue2 {
		width: 180px;
		float:left;
		margin-bottom: 15px;
	}
	
	.value {
		width: 30px;
		float: left;
		text-align: center;
		margin-left: 12px;
		margin-top: -2px;
		margin-bottom: 6px;

		font-family: Georgia, "Times New Roman", Times, serif;
		padding: 4px 0 1px 0;
		font-weight: bold;
		font-size: 12px;
		
	}
	
	#swatch {
		width: 130px;
		height: 130px;
		margin-top: 18px;
		margin-left: 250px;
		background-image: none;
	}
	
	.ui-slider-handle { border-color: #729fcf;
		-moz-box-shadow: 2px 4px 8px rgba(0,0,0,0.5);
		-webkit-box-shadow: 2px 4px 8px rgba(0,0,0,0.5);
		box-shadow: 2px 4px 8px rgba(0,0,0,0.5);
		outline: none; 
	}
	
	#red8 .ui-slider-range { background: #ef2929; }
	#red8 .ui-slider-handle { border-color: #ef2929;}
	#green8 .ui-slider-range { background: #8ae234; }
	#green8 .ui-slider-handle { border-color: #8ae234;}
	#blue8 .ui-slider-range { background: #729fcf; }
	#blue8 .ui-slider-handle { border-color: #729fcf; }
	
	#red3 .ui-slider-range { background: #ef2929; }
	#red3 .ui-slider-handle { border-color: #ef2929;}
	#green3 .ui-slider-range { background: #8ae234; }
	#green3 .ui-slider-handle { border-color: #8ae234;}
	#blue2 .ui-slider-range { background: #729fcf; }
	#blue2 .ui-slider-handle { border-color: #729fcf;}
	
	.ui-slider-tick-mark{
		display:inline-block;
		width:1px;
		background:black;
		height:5px;
		position:absolute;
		top:15px;
		z-index: 0; 
	}
	</style>
	

</head>

<body class="ui-widget-content" style="border: 0;">
<div id="container" style="width:840px">
	<div id="header" style="background-color:#FFFFFF;">
		<p class="ui-state-default ui-corner-all ui-helper-clearfix" style="padding: 4px; margin: 2px 0px 2px 0px;">
		<strong> <em>The Color Matcher 5000</em> </strong>
		</p>
	</div>
	<div class="ui-state-default ui-corner-all ui-helper-clearfix">
		<div class="mainContent" style="width:250px;
			float:left; position:relative;">
			<canvas id="imagecanvas" width="230" height="230" style="position:absolute; top:50%; 
						height:230px; 
						margin-top:-110px; 
						cursor:crosshair;
						left: 50%;
						margin-left: -110px; " class="add-shadow ui-state-default ui-corner-all"> 
				Your browser does not support the HTML5 canvas tag.
			</canvas>
		</div>
		<div id="content" class="mainContent" style="width:350px; float:left;">
			<canvas id="hexagons" width="350" height="340" style="border:0px solid #d3d3d3;z-index:1;">
				Your browser does not support the HTML5 canvas tag.
			</canvas>
		</div>
		<div class="mainContent" style="width:220px; float:left;">
			<div class="24bitslidersBubble" style="width:250px; height:50%;float:left;">
				
				<p style="margin-top: 28px; margin-bottom: 5px;">24bit</p>
				<div id="red8" class="allSliders 24bitgroup add-embossed ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false"><div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: 27.8431%;"></div><a class="ui-slider-handle ui-state-default ui-corner-all" href="http://www.cosc.canterbury.ac.nz/csfieldguide/dev/dev/_static/widgets/DR/DR-color/CG-ColorBits_2.html#" style="left: 27.8431%;"></a></div>
				<div id="red8value" class="value add-embossed" style="background-color:#FF4040">71</div>
					 
				<div id="green8" class="allSliders 24bitgroup add-embossed ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false"><div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: 97.6471%;"></div><a class="ui-slider-handle ui-state-default ui-corner-all" href="http://www.cosc.canterbury.ac.nz/csfieldguide/dev/dev/_static/widgets/DR/DR-color/CG-ColorBits_2.html#" style="left: 97.6471%;"></a></div>
				<div id="green8value" class="value add-embossed" style="background-color:#40FF40">249</div>
					 
				<div id="blue8" class="allSliders 24bitgroup add-embossed ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false"><div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: 50.9804%;"></div><a class="ui-slider-handle ui-state-default ui-corner-all" href="http://www.cosc.canterbury.ac.nz/csfieldguide/dev/dev/_static/widgets/DR/DR-color/CG-ColorBits_2.html#" style="left: 50.9804%;"></a></div>
				<div id="blue8value" class="value add-embossed" style="background-color:#729fcf">130</div>
			</div>
			
			<div style="width:250px; height:50%;float:left;">
				<p style="margin-top: 13px;margin-bottom: 5px;">8bit</p>
				<div id="red3" class="allSliders 8bitgroup add-embossed ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false"><div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: 42.8571%;"></div><a class="ui-slider-handle ui-state-default ui-corner-all" href="http://www.cosc.canterbury.ac.nz/csfieldguide/dev/dev/_static/widgets/DR/DR-color/CG-ColorBits_2.html#" style="left: 42.8571%;"></a><span class="ui-slider-tick-mark" style="left: 25.7143px;"></span><span class="ui-slider-tick-mark" style="left: 51.4286px;"></span><span class="ui-slider-tick-mark" style="left: 77.1429px;"></span><span class="ui-slider-tick-mark" style="left: 102.857px;"></span><span class="ui-slider-tick-mark" style="left: 128.571px;"></span><span class="ui-slider-tick-mark" style="left: 154.286px;"></span></div>
				<div id="red3value" class="value add-embossed" style="background-color:#FF4040">3</div>
					 
				<div id="green3" class="allSliders 8bitgroup add-embossed ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false"><div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: 0%;"></div><a class="ui-slider-handle ui-state-default ui-corner-all" href="http://www.cosc.canterbury.ac.nz/csfieldguide/dev/dev/_static/widgets/DR/DR-color/CG-ColorBits_2.html#" style="left: 0%;"></a><span class="ui-slider-tick-mark" style="left: 25.7143px;"></span><span class="ui-slider-tick-mark" style="left: 51.4286px;"></span><span class="ui-slider-tick-mark" style="left: 77.1429px;"></span><span class="ui-slider-tick-mark" style="left: 102.857px;"></span><span class="ui-slider-tick-mark" style="left: 128.571px;"></span><span class="ui-slider-tick-mark" style="left: 154.286px;"></span></div>
				<div id="green3value" class="value add-embossed" style="background-color:#40FF40">0</div>
					 
				<div id="blue2" class="allSliders 8bitgroup add-embossed ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false"><div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: 66.6667%;"></div><a class="ui-slider-handle ui-state-default ui-corner-all" href="http://www.cosc.canterbury.ac.nz/csfieldguide/dev/dev/_static/widgets/DR/DR-color/CG-ColorBits_2.html#" style="left: 66.6667%;"></a><span class="ui-slider-tick-mark" style="left: 60px;"></span><span class="ui-slider-tick-mark" style="left: 120px;"></span></div>
				<div id="blue2value" class="value add-embossed" style="background-color:#729fcf">2</div>
			</div>
		</div>
	</div>
	<div id="footer" style="background-color:#FFFFFF;clear:both;text-align:center;width: 840px ">
		<p class="ui-state-default ui-corner-all ui-helper-clearfix" style="padding: 4px; margin: 2px 0px 2px 0px; ">
			<span class="ui-icon ui-icon-pencil" style="float: left; margin: -2px 1px 0 0;"></span>
			First click inside the image window, the hexagon will show the color you have selected. Then try matching the color of this with the other two hexagons using the sliders on the right.
		</p>
	</div>
</div>



<script>
	// 255 200 238
	var color_select_24bit = "#FFC8EE";
	var color_24bit = "#000000";
	var color_8bit = "#000000";
	
	//var toolHelpTime = 60000; // 1_mins
	var toolHelpTime = 5000; // 1_mins
	var toolIgnoreTime = 5000; // 5_seco
	
	$(function() 
	{
		
		var $r8 = $("#red8"), $g8 = $("#green8"), $b8 = $("#blue8"),
			$r3 = $("#red3"), $g3 = $("#green3"), $b2 = $("#blue2");
			
		var $r8text = $('#red8value'), $g8text = $('#green8value'), $b8text = $('#blue8value'),
			$r3text = $('#red3value'), $g3text = $('#green3value'), $b2text = $('#blue2value');
				
		var timer = null;
                
		
		$.fn.SolveIt = function() {	
			solveBalloon.hideBalloon();
			answerBalloon.showBalloon();
			give24bitvalues();
		}
		
		$.fn.HideIt = function() {
			userHelpReset(); 
			solveBalloon.hideBalloon();
			answerBalloon.hideBalloon();
		}

		var solveBalloon = $('#red8').showBalloon( { 	
			contents:
					'<a>Hello! \
					<br>Matching colors perfectly is really hard, \
					<br>especially with 24-bit RGB. Do you want me to help?<a> \
					<button onclick="$.fn.SolveIt();">Yes</button> \
					<button onclick="$.fn.HideIt();">No</button>',
			offsetX: -20,
			offsetY: 10,
			tipSize: 24,
			css: { opacity: "0.95"}
		});
		solveBalloon.hideBalloon();
		
		var answerBalloon = $('#blue8').showBalloon( { 	
			contents:
				'<div style="width:280px;"> \
					<div style="width:230px; height:50px; float:left;"> \
						<a>Here are the correct values. You can select a slider and use keyboard arrow keys \
						for finer adjustments.</a>\
					</div>\
					<div style="width:30px; height:50px; margin-top: 8px; float:left;"> \
						<div id="rightRed8" class=\'value add-embossed\' style=\'background-color:#FF4040\'>0</div> \
						<div id="rightGreen8" class=\'value add-embossed\' style=\'background-color:#40FF40\'>0</div> \
						<div id="rightBlue8" class=\'value add-embossed\' style=\'background-color:#729fcf\'>0</div> \
					</div>\
					<div style="width:340px; float:left;"> \
					<button onclick="$.fn.HideIt();">Got it thanks</button>\
					</div> \
				 </div>',
			offsetX: 50,
			offsetY: -125,
			tipSize: 24,
			css: { opacity: "0.9"}
		});
		answerBalloon.hideBalloon();
	
		function hexFromRGB(r, g, b) {
			
			r = Math.floor(r);
			g = Math.floor(g);
			b = Math.floor(b);

			var hex = [
				r.toString( 16 ),
				g.toString( 16 ),
				b.toString( 16 )
			];
		
			$.each( hex, function( nr, val ) {
				if ( val.length === 1 ) {
					hex[ nr ] = "0" + val;
				}
			});
			return "#" + hex.join( "" ).toUpperCase();
		}
	
		function hexToRgb(hex) {
			// Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
			var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
			hex = hex.replace(shorthandRegex, function(m, r, g, b) {
				return r + r + g + g + b + b;
			});

			var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
			return result ? {
				r: parseInt(result[1], 16),
				g: parseInt(result[2], 16),
				b: parseInt(result[3], 16)
			} : null;
		}
		
		function setSliderTicks($slider){
			var width = $slider.width();
			var max =  $slider.slider("option", "max");    
			var step = $slider.slider("option", "step");  
			var ws = width/max;
			
			$slider.find('.ui-slider-tick-mark').remove();
			for (var i = 1; i < max; i++) {
				$('<span class="ui-slider-tick-mark"></span>').css('left', (ws * i) +  'px').appendTo($slider); 
			}
		}
		
		function give24bitvalues() {
			var colorRGB = hexToRgb(color_select_24bit);
			$('#rightRed8').text(colorRGB.r);
			$('#rightGreen8').text(colorRGB.g);
			$('#rightBlue8').text(colorRGB.b);
			
		}
		function solve24bit() {
			var colorRGB = hexToRgb(color_select_24bit);
			
			color_24bit = color_select_24bit;
			
			//divert onchange callback
			$(".allSliders").slider({ change: function(){} , slide: function(){} });
			
			$r8.slider("value", colorRGB.r); 
			$g8.slider("value", colorRGB.g); 
			$b8.slider("value", colorRGB.b);
			
			update(null,null);
			$(".allSliders").slider({change: update, slide: update});
		}

		function updateColor()
		{
			color_24bit = hexFromRGB($r8.slider("value"), 
									 $g8.slider("value"), 
									 $b8.slider("value"));
								 
			color_8bit = hexFromRGB($r3.slider( "value") * 36.428571429, 
									$g3.slider( "value") * 36.428571429, 
									$b2.slider( "value") * 85);
		}
	
		var tipTimer = null;
		var user_ignore_period_time = null;
		function resetHelpTimer(showtime, ignoretime)
		{
			//reset
			if(tipTimer != null) window.clearInterval(tipTimer);
			tipTimer = setTimeout(
				function() {
					if(color_select_24bit != color_24bit) //colors don't match
					{
						solveBalloon.showBalloon();
						user_ignore_period_time =  setTimeout(
							function() {user_ignore_period_time = null
							}, ignoretime);
					} else { console.log("Its correct"); }
					tipTimer = null;
				}, showtime);
		}
		
		function userHelpReset()
		{
			if(tipTimer != null) window.clearInterval(tipTimer);
			if(user_ignore_period_time != null) window.clearInterval(user_ignore_period_time);
			tipTimer = null;
			user_ignore_period_time = null;
		}
	
		//called by slider change
		function update(event, ui) {
			if(ui != null) //system called not me
			{			
				if($(this).slider("value") != ui.value) {
					$(this).slider("value", ui.value); //fix drag, instant update
				}
				
				//the sliders have been changed
				//user_ignore
				if(!solveBalloon.isHiddenBalloon()) //help is shown
				{
					console.log("User made change with tool showing");
					if(user_ignore_period_time == null) //for over 5 seconds since help was shown
					{
						console.log("User IGNORES, hide, timer resets");
						solveBalloon.hideBalloon();
						resetHelpTimer(toolHelpTime, toolIgnoreTime); //start the timer too show
					}
				}
				
				// 
				// the sliders have been changed
				// the user might need help, but give them time to experiment
				// user_solving
				if(solveBalloon.isHiddenBalloon() && answerBalloon.isHiddenBalloon()) //help is hidden &
				if(tipTimer == null) {  //timer has run out, or not started &
					if(color_select_24bit != color_24bit) //colors don't match
					{
						console.log("User is given time to solve");
						resetHelpTimer(toolHelpTime, toolIgnoreTime); //start the timer too show
					}
				}
			}
		
			updateColor();
			
			//update text
			$r8text.text($r8.slider("value"));
			$g8text.text($g8.slider("value"));
			$b8text.text($b8.slider("value"));
			
			$r3text.text($r3.slider( "value"));
			$g3text.text($g3.slider( "value"));
			$b2text.text($b2.slider( "value"));
                     
			
			if (timer == null) timer = window.setTimeout(function()
			{
			  animate(); 
			  timer = null;
			}, 50);
			//animate();
		}
			
		$( "#red8, #green8, #blue8" ).slider({
			orientation: "horizontal",
			range: "min",
			max: 255,
			value: 60
		});
		
		$( "#red3, #green3" ).slider({
			orientation: "horizontal",
			range: "min",
			max: 7,
			value: 3
		});	
		
		$( "#blue2" ).slider({
			orientation: "horizontal",
			range: "min",
			max: 3,
			value: 1
		});	
		
		$('.allSliders').each(function()
		{ 
			$(this).slider("value", Math.random() * $(this).slider("option", "max"));
		});
		
		$(".allSliders").slider({
		  change: update,
		  slide: update
		});
	
		setSliderTicks($('#red3'));
		setSliderTicks($('#green3'));
		setSliderTicks($('#blue2'));
		
	
		var b=document.getElementById("imagecanvas");
		var btx=b.getContext("2d");

		// load image from data url
		var imageObj = new Image();
		imageObj.onload = function() {
		  btx.drawImage(this, 0,0, b.width, b.height);
		};
		imageObj.src = 'images/splash.jpg';	
		btx.drawImage(imageObj,10,10);
		

		function pad(n, width, z) {
			z = z || '0';
			n = n + '';
			return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;
		}
		
		function findPos(obj) {
			var curleft = 0, curtop = 0;
			if (obj.offsetParent) {
				do {
					curleft += obj.offsetLeft;
					curtop += obj.offsetTop;
				} while (obj = obj.offsetParent);
				return { x: curleft, y: curtop };
			}
			return undefined;
		}

		var c=document.getElementById("hexagons");
		var ctx=c.getContext("2d");
		function hexigon(ctx, width, height, fillColor)
		{
			ctx.fillStyle = fillColor;
			ctx.lineWidth = 0;
			ctx.strokeStyle = fillColor;
			ctx.moveTo(0.00, 0.0);
			ctx.lineTo(0.25 * width,-1.0 * height/2);
			ctx.lineTo(0.75 * width,-1.0 * height/2);
			ctx.lineTo(1.00 * width, 0.0 * height/2);
			ctx.lineTo(0.75 * width, 1.0 * height/2);
			ctx.lineTo(0.25 * width, 1.0 * height/2);
			ctx.closePath();
			ctx.fill();
		}

		function drawHexgroup(c1, c2, c3)
		{
			var overlap = 1.01;
			ctx.scale(1.5,1.5);
			ctx.translate(10.5,110.5);
			ctx.beginPath();
			
			ctx.save();
			ctx.translate(120-(120*.25), -50);
			ctx.scale(overlap,overlap);
			hexigon(ctx, 120,100, c1);
			ctx.restore();
			
			ctx.beginPath();
			ctx.save();
			ctx.translate(120-(120*.25), 50);
			ctx.scale(overlap,overlap);
			hexigon(ctx, 120,100, c2);
			ctx.restore();
		
			ctx.beginPath();
			ctx.save();
			ctx.scale(overlap,overlap);
			hexigon(ctx, 120,100, c3);
			ctx.restore();
		}

		function animate() {
			// clear
			ctx.clearRect(0, 0, c.width, c.height);
						
			//draw shadow first
			ctx.save();
			ctx.shadowColor = 'black';
			ctx.shadowBlur = 20;
			ctx.shadowOffsetX = 5;
			ctx.shadowOffsetY = 5;
			drawHexgroup(null, null, null)
			ctx.restore();
		
			ctx.save();
			drawHexgroup(color_24bit, color_8bit, color_select_24bit)
			ctx.restore();
		}
		
		$('#imagecanvas').click(function(e) {
			var pos = findPos(this);
			var x = e.pageX - pos.x;
			var y = e.pageY - pos.y;
			var c = this.getContext('2d');
			var p = c.getImageData(x, y, 1, 1).data; 
			color_select_24bit = hexFromRGB(p[0], p[1], p[2]);
			update(null,null);
			$.fn.HideIt();
		});
	
		animate();
		update(null,null);

	});
	</script>

<div style="min-width: 20px; padding: 5px; border-radius: 6px; border: 1px solid rgb(119, 119, 119); box-shadow: rgb(85, 85, 85) 4px 4px 4px; color: rgb(102, 102, 102); opacity: 0.95; z-index: 32767; text-align: left; visibility: visible; position: absolute; top: 18px; left: 460.5px; display: none; background-color: rgb(239, 239, 239);"><a>Hello! 					<br>Matching colors perfectly is really hard, 					<br>especially with 24-bit RGB. Do you want me to help?</a><a> 					<button onclick="$.fn.SolveIt();">Yes</button> 					<button onclick="$.fn.HideIt();">No</button></a><div style="position: absolute; height: 0px; width: 0px; border-style: solid; border-width: 24px 14px 0px; border-color: rgb(119, 119, 119) transparent transparent; top: 67px; left: 203px;"></div><div style="position: absolute; height: 0px; width: 0px; border-style: solid; border-width: 22px 13px 0px; border-color: rgb(239, 239, 239) transparent transparent; top: 67px; left: 204px;"></div></div><div style="min-width: 20px; padding: 5px; border-radius: 6px; border: 1px solid rgb(119, 119, 119); box-shadow: rgb(85, 85, 85) 4px 4px 4px; color: rgb(102, 102, 102); opacity: 0.9; z-index: 32767; text-align: left; visibility: visible; position: absolute; top: 225px; left: 603px; display: none; background-color: rgb(239, 239, 239);"><div style="width:280px;"> 					<div style="width:230px; height:50px; float:left;"> 						<a>Here are the correct values. You can select a slider and use keyboard arrow keys 						for finer adjustments.</a>					</div>					<div style="width:30px; height:50px; margin-top: 8px; float:left;"> 						<div id="rightRed8" class="value add-embossed" style="background-color:#FF4040">0</div> 						<div id="rightGreen8" class="value add-embossed" style="background-color:#40FF40">0</div> 						<div id="rightBlue8" class="value add-embossed" style="background-color:#729fcf">0</div> 					</div>					<div style="width:340px; float:left;"> 					<button onclick="$.fn.HideIt();">Got it thanks</button>					</div> 				 </div><div style="position: absolute; height: 0px; width: 0px; border-style: solid; border-width: 0px 14px 24px; border-color: transparent transparent rgb(119, 119, 119); top: -24px; left: 131px;"></div><div style="position: absolute; height: 0px; width: 0px; border-style: solid; border-width: 0px 13px 22px; border-color: transparent transparent rgb(239, 239, 239); top: -22px; left: 132px;"></div></div></body></html>